---
// components/Member.astro

import LinkButton from "./LinkButton.astro";
import socialIcons from "@assets/socialIcons";
import { isExternalLink } from "../utils/openExternalLinks";
import "../styles/profile.css"

export interface Props {
name: string;
bio?: string;
url?: string;
socials: { name: string; href: string }[];
badges?: string[];
core?: boolean;
ally?: boolean;
volunteer?: boolean;
}

const { name, bio, url, socials, badges = [], core = false, ally = false, volunteer = false} = Astro.props;

// Define GitHub profile picture URL
const githubUrl = socials.find(s => s.name === 'GitHub')?.href;
const profilePicture = `${githubUrl}.png?size=200`;

const currDomain = new URL(Astro.url.origin).hostname;
const isExternal = url ? isExternalLink(url, currDomain) : false;
---

<div class="profile">
  <img src={profilePicture} alt={`${name}'s profile picture`} class="profile-picture" />
  <div class="profile-details">
    <h2>{name}</h2>
    {!core && (
      <div class="role-badge">
      <span class:list={['badge', volunteer ? 'volunteer-badge' : 'member-badge']}>
      {volunteer ? 'Volunteer' : 'Member'}
      </span>
      {ally ? <span class="badge ally-badge">Ally</span> : null}
      </div>
    )}
    {core && (
    <div class="badges">
      {badges.map((badge) => (
      <span class="badge capitalize">{badge}</span>
      ))}
      {ally ? <span class="badge ally-badge">Ally</span> : null}
    </div>
    )}
    {bio && <p class="bio">{bio}</p>}
    {url && (
    <a 
    class="website" 
    href={url} 
    aria-label={isExternal ? `${url} (opens in new tab)` : url} 
        target={isExternal ? "_blank" : undefined} 
        rel={isExternal ? "noopener noreferrer" : undefined}
        >
      {url}
    </a>
    )}
    <div class="social-icons">
      {socials.map(social => (
      <LinkButton 
      href={`${social.href}`} 
      className="link-button" 
      title={`${social.name}`}
      >
        <Fragment set:html={socialIcons[social.name as keyof typeof socialIcons]} />
      </LinkButton>
      ))}
    </div>
  </div>
</div>


